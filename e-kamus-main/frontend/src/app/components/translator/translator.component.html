<div class="translator-container">
  <!-- Simple Header -->
  <div class="header">
    <h1>E-Kamus Translate</h1>
  </div>

  <!-- Main Translation Box -->
  <div class="translation-box">
    <!-- Language Selection Row -->
    <div class="language-row">
      <div class="language-select">
        <label for="source-lang">From</label>
        <select id="source-lang" [(ngModel)]="sourceLang" class="lang-dropdown">
          @for (lang of languages; track lang.code) {
          <option [value]="lang.code">{{ lang.name }}</option>
          }
        </select>
      </div>

      <!-- Swap Button -->
      <button class="swap-button" (click)="swapLanguages()" title="Swap languages"
        aria-label="Swap source and target languages">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4" />
        </svg>
      </button>

      <div class="language-select">
        <label for="target-lang">To</label>
        <select id="target-lang" [(ngModel)]="targetLang" class="lang-dropdown">
          @for (lang of languages; track lang.code) {
          <option [value]="lang.code">{{ lang.name }}</option>
          }
        </select>
      </div>
    </div>

    <!-- Text Input/Output Area -->
    <div class="text-area-container">
      <!-- Source Text Area -->
      <div class="text-section">
        <div class="text-header">
          <h3>Source Text</h3>
          <span class="character-count">{{ sourceText().length }}/5000</span>
        </div>
        <textarea class="text-input" [(ngModel)]="sourceText" placeholder="Enter text to translate..." maxlength="5000"
          (keyup.enter)="sourceText().length > 0 && translate()">
        </textarea>
        <div class="text-actions">
          <button class="btn-secondary" (click)="clearAll()" [disabled]="!sourceText() && !translatedText()">
            Clear
          </button>
          <button class="btn-secondary" (click)="copyToClipboard(sourceText())" [disabled]="!sourceText()"
            title="Copy source text">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
              <rect x="8" y="2" width="8" height="4" rx="1" />
            </svg>
            Copy
          </button>
        </div>
      </div>

      <!-- Target Text Area -->
      <div class="text-section">
        <div class="text-header">
          <h3>Translation</h3>
          <span class="character-count">{{ translatedText().length }}</span>
        </div>
        <div class="text-output">
          @if (isLoading()) {
          <div class="loading">
            <div class="spinner"></div>
            <p>Translating...</p>
          </div>
          } @else if (translatedText()) {
          <p>{{ translatedText() }}</p>
          } @else {
          <p class="placeholder">Translation will appear here...</p>
          }
        </div>
        <div class="text-actions">
          <button class="btn-secondary" (click)="copyToClipboard(translatedText())" [disabled]="!translatedText()"
            title="Copy translated text">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
              <rect x="8" y="2" width="8" height="4" rx="1" />
            </svg>
            Copy
          </button>
        </div>
      </div>
    </div>

    <!-- Translate Button -->
    <button class="btn-primary" (click)="translate()" [disabled]="!sourceText() || isLoading()">
      @if (isLoading()) {
      <span>Translating...</span>
      } @else {
      <span>Translate</span>
      }
    </button>

    <!-- Error Message -->
    @if (error()) {
    <div class="error-message">
      {{ error() }}
    </div>
    }

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="action-btn" (click)="lookupDictionary()" [disabled]="!sourceText() || isLoading()"
        title="Dictionary Lookup">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
        Dictionary
      </button>
    </div>
  </div>

  <!-- Dictionary Modal -->
  @if (showDictionary() && dictionaryResult()) {
  <div class="modal-overlay" (click)="closeDictionary()">
    <div class="modal-content dictionary-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Dictionary Entry</h2>
        <div class="modal-actions">
          <button class="close-btn" (click)="closeDictionary()">âœ•</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="dictionary-entry">
          <!-- Word Headers -->
          <div class="word-headers">
            @if (dictionaryLookupFromMalay()) {
            <!-- Show Malay first (left/blue) when looked up from Malay -->
            @if (dictionaryResult().malayWord) {
            <div class="word-section malay-first">
              <h3 class="word-title">{{ dictionaryResult().malayWord }}</h3>
              <span class="language-badge malay">Malay</span>
            </div>
            }
            @if (dictionaryResult().mandarinWord) {
            <div class="word-section mandarin-second">
              <h3 class="word-title mandarin">{{ dictionaryResult().mandarinWord }}</h3>
              <span class="language-badge chinese">Chinese</span>
            </div>
            }
            } @else {
            <!-- Show Chinese first (left/purple) when looked up from Chinese -->
            @if (dictionaryResult().mandarinWord) {
            <div class="word-section mandarin-first">
              <h3 class="word-title mandarin">{{ dictionaryResult().mandarinWord }}</h3>
              <span class="language-badge chinese">Chinese</span>
            </div>
            }
            @if (dictionaryResult().malayWord) {
            <div class="word-section malay-second">
              <h3 class="word-title">{{ dictionaryResult().malayWord }}</h3>
              <span class="language-badge malay">Malay</span>
            </div>
            }
            }
          </div>

          <!-- Pronunciation -->
          @if (dictionaryResult().pinyin) {
          <div class="detail-section pronunciation">
            <h4 class="section-title">PRONUNCIATION:</h4>
            <p class="pinyin-text">{{ dictionaryResult().pinyin }}</p>
          </div>
          }

          <!-- Explanation -->
          @if (dictionaryResult().explanation) {
          <div class="detail-section explanation">
            <h4 class="section-title">EXPLANATION:</h4>
            <p class="explanation-text">{{ dictionaryResult().explanation }}</p>
          </div>
          }

          <!-- Word Type -->
          <div class="detail-section word-type">
            <h4 class="section-title">IS_ADJECTIVE:</h4>
            <p class="word-type-badge" [class.adjective]="dictionaryResult().adjective">
              {{ dictionaryResult().adjective ? 'YES' : 'NO' }}
            </p>
          </div>

          <!-- Examples -->
          @if (dictionaryResult().examples) {
          <div class="detail-section examples">
            <h4 class="section-title">EXAMPLES:</h4>
            <div class="examples-list">
              @for (example of parseExamples(dictionaryResult().examples); track $index) {
              <div class="example-item">
                <p class="example-number">{{ $index + 1 }}.</p>
                <div class="example-text">
                  @if (example.chinese) {
                  <p class="example-chinese">{{ example.chinese }}</p>
                  }
                  <p class="example-malay">{{ example.malay }}</p>
                </div>
              </div>
              }
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
  }
</div>